/*
 * Jatt - just another tooltip v2.8.1 min
 * http://github.com/Mottie/Jatt
 * by Rob Garrison (aka Mottie)
 *
 * based on tooltip by Alen Grakalic (http://cssglobe.com/post/1695/easiest-tooltip-and-image-preview-using-jquery)
 * tooltip modification by Rob G, aka Mottie (http://wowmotty.blogspot.com/)
 *
 */

(function(b){b.jatt=function(v){var i,s,t=[],u=b("body"),o=b(document),r=b(window),d=b.extend({},b.jatt.defaultOptions,v);b.jatt.ttrelocate=function(j,h){var g=b("#"+h),a=g.outerWidth(),e=g.outerHeight(),c=g.data("options")||d,m={e:[c.xOffset,-e/2,a+c.xOffset,e/2],se:[c.xOffset,c.yOffset,a+c.xOffset,e+c.yOffset],s:[-a/2,c.yOffset,a/2,e+c.yOffset],sw:[-a-c.xOffset,c.yOffset,-c.xOffset,e+c.yOffset],w:[-a-c.xOffset,-e/2,-c.xOffset,e/2],nw:[-a-c.xOffset,-e-c.yOffset,-c.xOffset,-c.yOffset],n:[-a/2,-e- c.yOffset,a/2,-c.yOffset],ne:[c.xOffset,-e-c.yOffset,a+c.xOffset,-c.yOffset]}[c.direction],k=r.scrollTop(),p=r.scrollLeft(),f=b(j.target),n=j.pageX||f.position().left+f.width()/2,l=j.pageY||f.position().top+f.height()/2;if(!c.followMouse){n=f.outerWidth();l=f.outerHeight();l={e:[n,l/2],se:[n,l],s:[n/2,l],sw:[0,l],w:[0,l/2],nw:[0,0],n:[n/2,0],ne:[n,0]};n=f.offset().left+l[c.direction][0];l=f.offset().top+l[c.direction][1]}f=n+m[0];var q=l+m[1];if(n+m[2]>p+r.width()-c.xOffset)f=r.width()-a-c.xOffset; if(l+m[3]>k+r.height()-c.yOffset)q=l-e-c.yOffset;if(f<p+c.xOffset)f=p+c.xOffset;if(q<k+c.yOffset)q=l+c.yOffset;if(n>f&&n<f+a&&l>q&&l<q+e)q+=q-e/2-c.yOffset<k+c.yOffset?e/2+c.yOffset:-e/2-c.yOffset;g.css({left:f+"px",top:q+"px"})};b.jatt.getMeta=function(j){i=b.extend({},d);var h,g=[],a=j.attr(d.metadata)||"";a=a.match(/(\{.*\})/g)?a.match(/(\{.*\})/g)[0]:j.attr(d.metadata)||"";a=a.match("width|background|color|border|direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")?a:j.attr("data-jatt")|| "";if(a!==""){a=a.replace(/(\{|\'|\"|\})/g,"");if(a.match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){b.each(a.split(";"),function(e,c){h=c.split(":");if(h[0].match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){var m=b.trim(h[0]),k=b.trim(h[1]);i[m]=k=="true"||k=="false"?k=="true"?true:false:isNaN(k)?k:parseFloat(k)}else g.push(c)});a=g.join(";")}}h=j.attr("rel")||"";if(h!==""&&!/^[#|\.]|[\/]/.test(h)){h=h.split(",");a+=";width:"+h[0]+"px;";if(typeof h[1]!== "undefined")a+="background:"+h[1]}return[i,a]};b.jatt.removeTooltips=function(){for(b("#"+d.previewId+", #"+d.tooltipId).remove();b("#"+d.previewId+", #"+d.tooltipId).length>0;)b("#"+d.previewId+", #"+d.tooltipId).remove()};b.jatt.preloadContent=function(j){var h,g,a,e,c,m=[],k=b(d.tooltip);for(c=j.length;c--;){h=document.createElement("img");h.src=j[c];t.push(h)}k.each(function(p){g=b(this);if(this.tagName==="A"&&g.is(d.preloadContent)){e=b(this).attr("href")||"";if(e!==""&&!e.match(/^#/)){a=b('<div rel="'+ p+'" />');m.push(a);a.load(e,function(){k.eq(a.attr("rel")).data("tooltip",a.html())})}}})};(function(){var j=d.live?"live":"bind",h=[];b.each("jatt-initialized jatt-beforeReveal jatt-revealed jatt-hidden".split(" "),function(g,a){b.isFunction(d[a])&&o.bind(a,d[a])});b(d.tooltip)[j](d.activate,function(g){var a,e,c,m,k,p,f=b(this);a=d.metadata.toString()=="false"?[d,""]:b.jatt.getMeta(f);o.trigger("jatt-initialized",f);i=a[0];e=f.attr(i.content)===""?f.data("tooltip")||"":f.attr(i.content)||"";c= f.attr("rel")||"";m=f.attr("href")||"";f.data("tooltip",e);f.attr("title","");a='<div id="'+d.tooltipId+'" style="position:absolute;z-index:'+i.zIndex+";"+a[1]+'"></div>';i.local?f.before(a):u.append(a);if(e==="")if(c!=="")e=b(c).html()||d.notFound;else if(m!==""){e=d.loading;k=b("<div />");k.load(m,function(){p=k.html();t=d.cacheData?p:"";b("#"+d.tooltipId).hide().html(p);f.data("tooltip",t);b.jatt.ttrelocate(g,d.tooltipId);b("#"+d.tooltipId).show()})}b("#"+d.tooltipId).html(e).data("options",i); b.jatt.ttrelocate(g,d.tooltipId);o.trigger("jatt-beforeReveal",f);b("#"+d.tooltipId).fadeIn(i.speed);o.trigger("jatt-revealed",f)})[j](d.deactivate,function(){b.jatt.removeTooltips();o.trigger("jatt-hidden",this)})[j]("mousemove",function(g){b("#"+d.tooltipId).length&&i.followMouse&&b.jatt.ttrelocate(g,d.tooltipId)});s=function(g,a,e){o.trigger("jatt-initialized",a);var c,m=d.metadata.toString()=="false"?[d,""]:b.jatt.getMeta(a);i=m[0];c=a.attr(i.content)===""?a.data("tooltip")||"":a.attr(i.content)|| "";a.data("tooltip",c);i.content==="title"&&a.attr(i.content,"");e='<div id="'+d.previewId+'" style="position:absolute;z-index:'+i.zIndex+";"+m[1]+'">'+e;e+=c!==""?"<br/>"+c+"</div>":"</div>";i.local?a.before(e):u.append(e);o.trigger("jatt-beforeReveal",a);b("#"+d.previewId).hide().data("options",i).fadeIn(i.speed);b.jatt.ttrelocate(g,d.previewId);o.trigger("jatt-revealed",a)};b(d.preview)[j](d.activate,function(g){s(g,b(this),'<img src="'+b(this).attr("href")+'" alt="'+d.imagePreview+'" />')});b(d.preview+ d.preloadContent).each(function(){h.push(b(this).attr("href"))});b(d.screenshot)[j](d.activate,function(g){var a=b(this),e='<img src="'+(a.attr("rel")==="#"?d.websitePreview+a.attr("href"):a.attr("rel"));e+='" alt="'+d.siteScreenshot+a.attr("href")+'" />';s(g,a,e)});b(d.screenshot+d.preloadContent).each(function(){var g=b(this);h.push(g.attr("rel")==="#"?d.websitePreview+g.attr("href"):g.attr("rel"))});b(d.preview+","+d.screenshot)[j](d.deactivate,function(){b.jatt.removeTooltips();o.trigger("jatt-hidden", this)})[j]("mousemove",function(g){b("#"+d.previewId).length&&i.followMouse&&b.jatt.ttrelocate(g,d.previewId)});b.jatt.preloadContent(h)})()};b.jatt.defaultOptions={direction:"n",followMouse:true,content:"title",speed:300,local:false,xOffset:20,yOffset:20,zIndex:1E3,live:false,metadata:"class",activate:"mouseenter focusin",deactivate:"mouseleave focusout",cacheData:true,websitePreview:"http://api1.thumbalizr.com/?width=250&url=",loading:"Loading...",notFound:"No tooltip found",imagePreview:"Image preview", siteScreenshot:"URL preview: ",tooltip:".tooltip",screenshot:"a.screenshot",preview:"a.preview",preloadContent:".preload",tooltipId:"tooltip",previewId:"preview"}})(jQuery);
