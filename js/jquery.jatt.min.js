/*
 * Jatt - just another tooltip v2.8 min
 * http://github.com/Mottie/Jatt
 * by Rob Garrison (aka Mottie)
 *
 * based on tooltip by Alen Grakalic (http://cssglobe.com/post/1695/easiest-tooltip-and-image-preview-using-jquery)
 * tooltip modification by Rob G, aka Mottie (http://wowmotty.blogspot.com/)
 *
 */

(function(c){c.jatt=function(v){var i,s,t=[],u=c("body"),o=c(document),r=c(window),d=c.extend({},c.jatt.defaultOptions,v);c.jatt.ttrelocate=function(j,h){var g=c("#"+h),a=g.outerWidth(),e=g.outerHeight(),b=g.data("options")||d,m={e:[b.xOffset,-e/2,a+b.xOffset,e/2],se:[b.xOffset,b.yOffset,a+b.xOffset,e+b.yOffset],s:[-a/2,b.yOffset,a/2,e+b.yOffset],sw:[-a-b.xOffset,b.yOffset,-b.xOffset,e+b.yOffset],w:[-a-b.xOffset,-e/2,-b.xOffset,e/2],nw:[-a-b.xOffset,-e-b.yOffset,-b.xOffset,-b.yOffset],n:[-a/2,-e- b.yOffset,a/2,-b.yOffset],ne:[b.xOffset,-e-b.yOffset,a+b.xOffset,-b.yOffset]}[b.direction],k=r.scrollTop(),p=r.scrollLeft(),f=c(j.target),n=j.pageX||f.position().left+f.width()/2,l=j.pageY||f.position().top+f.height()/2;if(!b.followMouse){n=f.outerWidth();l=f.outerHeight();l={e:[n,l/2],se:[n,l],s:[n/2,l],sw:[0,l],w:[0,l/2],nw:[0,0],n:[n/2,0],ne:[n,0]};n=f.offset().left+l[b.direction][0];l=f.offset().top+l[b.direction][1]}f=n+m[0];var q=l+m[1];if(n+m[2]>p+r.width()-b.xOffset)f=r.width()-a-b.xOffset; if(l+m[3]>k+r.height()-b.yOffset)q=l-e-b.yOffset;if(f<p+b.xOffset)f=p+b.xOffset;if(q<k+b.yOffset)q=l+b.yOffset;if(n>f&&n<f+a&&l>q&&l<q+e)q+=q-e/2-b.yOffset<k+b.yOffset?e/2+b.yOffset:-e/2-b.yOffset;g.css({left:f+"px",top:q+"px"})};c.jatt.getMeta=function(j){i=c.extend({},d);var h,g=[],a=j.attr(d.metadata)||"";a=a.match(/(\{.*\})/g)?a.match(/(\{.*\})/g)[0]:j.attr(d.metadata)||"";a=a.match("width|background|color|border|direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")?a:j.attr("data-jatt")|| "";if(a!==""){a=a.replace(/(\{|\'|\"|\})/g,"");if(a.match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){c.each(a.split(";"),function(e,b){h=b.split(":");if(h[0].match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){var m=c.trim(h[0]),k=c.trim(h[1]);i[m]=k=="true"||k=="false"?k=="true"?true:false:isNaN(k)?k:parseFloat(k)}else g.push(b)});a=g.join(";")}}h=j.attr("rel")||"";if(h!==""&&!/^[#|\.]|[\/]/.test(h)){h=h.split(",");a+=";width:"+h[0]+"px;";if(typeof h[1]!== "undefined")a+="background:"+h[1]}return[i,a]};c.jatt.removeTooltips=function(){for(c("#"+d.previewId+", #"+d.tooltipId).remove();c("#"+d.previewId+", #"+d.tooltipId).length>0;)c("#"+d.previewId+", #"+d.tooltipId).remove()};c.jatt.preloadContent=function(j){var h,g,a,e,b,m=[],k=c(d.tooltip);for(b=j.length;b--;){h=document.createElement("img");h.src=j[b];t.push(h)}k.each(function(p){g=c(this);if(this.tagName==="A"&&g.is(d.preloadContent)){e=c(this).attr("href")||"";if(e!==""&&!e.match(/^#/)){a=c('<div rel="'+ p+'" />');m.push(a);a.load(e,function(){k.eq(a.attr("rel")).data("tooltip",a.html())})}}})};(function(){var j=d.live?"live":"bind",h=[];c.each("jatt-initialized jatt-beforeReveal jatt-revealed jatt-hidden".split(" "),function(g,a){c.isFunction(d[a])&&o.bind(a,d[a])});c(d.tooltip)[j](d.activate,function(g){var a,e,b,m,k,p,f=c(this);a=d.metadata.toString()=="false"?[d,""]:c.jatt.getMeta(f);o.trigger("jatt-initialized",f);i=a[0];e=f.attr(i.content)===""?f.data("tooltip")||"":f.attr(i.content)||"";b= f.attr("rel")||"";m=f.attr("href")||"";f.data("tooltip",e);f.attr("title","");a='<div id="'+d.tooltipId+'" style="position:absolute;z-index:'+i.zIndex+";"+a[1]+'"></div>';i.local?f.before(a):u.append(a);if(e==="")if(b!=="")e=c(b).html()||d.notFound;else if(m!==""){e=d.loading;k=c("<div />");k.load(m,function(){p=k.html();t=d.cacheData?p:"";c("#"+d.tooltipId).hide().html(p);f.data("tooltip",t);c.jatt.ttrelocate(g,d.tooltipId);c("#"+d.tooltipId).show()})}c("#"+d.tooltipId).html(e).data("options",i); c.jatt.ttrelocate(g,d.tooltipId);o.trigger("jatt-beforeReveal",f);c("#"+d.tooltipId).fadeIn(i.speed);o.trigger("jatt-revealed",f)})[j](d.deactivate,function(){c.jatt.removeTooltips();o.trigger("jatt-hidden",this)})[j]("mousemove",function(g){c("#"+d.tooltipId).length&&i.followMouse&&c.jatt.ttrelocate(g,d.tooltipId)});s=function(g,a,e){o.trigger("jatt-initialized",a);var b,m=d.metadata.toString()=="false"?[d,""]:c.jatt.getMeta(a);i=m[0];b=a.attr(i.content)===""?a.data("tooltip")||"":a.attr(i.content)|| "";a.data("tooltip",b);i.content==="title"&&a.attr(i.content,"");e='<div id="'+d.previewId+'" style="position:absolute;z-index:'+i.zIndex+";"+m[1]+'"><img src="'+e;e+=b!==""?"<br/>"+b+"</div>":"</div>";i.local?a.before(e):u.append(e);o.trigger("jatt-beforeReveal",a);c("#"+d.previewId).hide().data("options",i).fadeIn(i.speed);c.jatt.ttrelocate(g,d.previewId);o.trigger("jatt-revealed",a)};c(d.preview)[j](d.activate,function(g){s(g,c(this),c(this).attr("href")+'" alt="'+d.imagePreview+'" />')}).each(function(){h.push(c(this).attr("href"))}); c(d.screenshot)[j](d.activate,function(g){var a=c(this),e=a.attr("rel")==="#"?d.websitePreview+a.attr("href"):a.attr("rel");e+='" alt="'+d.siteScreenshot+a.attr("href")+'" />';s(g,a,e)}).each(function(){var g=c(this);h.push(g.attr("rel")==="#"?d.websitePreview+g.attr("href"):g.attr("rel"))});c(d.preview+","+d.screenshot)[j](d.deactivate,function(){c.jatt.removeTooltips();o.trigger("jatt-hidden",this)})[j]("mousemove",function(g){c("#"+d.previewId).length&&i.followMouse&&c.jatt.ttrelocate(g,d.previewId)}); c.jatt.preloadContent(h)})()};c.jatt.defaultOptions={direction:"n",followMouse:true,content:"title",speed:300,local:false,xOffset:20,yOffset:20,zIndex:1E3,live:false,metadata:"class",activate:"mouseenter focusin",deactivate:"mouseleave focusout",cacheData:true,websitePreview:"http://api1.thumbalizr.com/?width=250&url=",loading:"Loading...",notFound:"No tooltip found",imagePreview:"Image preview",siteScreenshot:"URL preview: ",tooltip:".tooltip",screenshot:"a.screenshot",preview:"a.preview",preloadContent:".preload", tooltipId:"tooltip",previewId:"preview"}})(jQuery);
