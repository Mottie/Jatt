/*
 * Jatt - just another tooltip v2.3 min (10/10/2010)
 * http://github.com/Mottie/Jatt
 * by Rob Garrison (aka Mottie)
 *
 * based on tooltip by Alen Grakalic (http://cssglobe.com/post/1695/easiest-tooltip-and-image-preview-using-jquery)
 * tooltip modification by Rob G, aka Mottie (http://wowmotty.blogspot.com/)
 *
 */

(function(b){b.jatt=function(r){var h,s=[],d=b.extend({},b.jatt.defaultOptions,r);b.jatt.ttrelocate=function(j,i){var g=b(window),c=b("#"+i),f=c.outerWidth(),e=c.outerHeight(),a=c.data("options"),l={e:[a.xOffset,-e/2,f+a.xOffset,e/2],se:[a.xOffset,a.yOffset,f+a.xOffset,e+a.yOffset],s:[-f/2,a.yOffset,f/2,e+a.yOffset],sw:[-f-a.xOffset,a.yOffset,-a.xOffset,e+a.yOffset],w:[-f-a.xOffset,-e/2,-a.xOffset,e/2],nw:[-f-a.xOffset,-e-a.yOffset,-a.xOffset,-a.yOffset],n:[-f/2,-e-a.yOffset,f/2,-a.yOffset],ne:[a.xOffset, -e-a.yOffset,f+a.xOffset,-a.yOffset]}[a.direction],p=g.scrollTop(),q=g.scrollLeft(),n=j.pageX,m=j.pageY;if(!a.followMouse){m=b(j.target);n=m.outerWidth();var k=m.outerHeight();k={e:[n,k/2],se:[n,k],s:[n/2,k],sw:[0,k],w:[0,k/2],nw:[0,0],n:[n/2,0],ne:[n,0]};n=m.offset().left+k[a.direction][0];m=m.offset().top+k[a.direction][1]}k=n+l[0];var o=m+l[1];if(n+l[2]>q+g.width()-a.xOffset)k=g.width()-f-a.xOffset;if(m+l[3]>p+g.height()-a.yOffset)o=m-e-a.yOffset;if(k<q+a.xOffset)k=q+a.xOffset;if(o<p+a.yOffset)o= m+a.yOffset;if(n>k&&n<k+f&&m>o&&m<o+e)o+=o-e/2-a.yOffset<p+a.yOffset?e/2+a.yOffset:-e/2-a.yOffset;c.css({left:k+"px",top:o+"px"})};b.jatt.getMeta=function(j){h=b.extend({},d);var i,g=[],c=j.attr(d.metadata).match(/(\{.*\})/g)||"";if(c!==""){c=c[0].replace(/(\{|\'|\"|\})/g,"");if(c.match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){b.each(c.split(";"),function(f,e){i=e.split(":");if(i[0].match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){var a=b.trim(i[0]), l=b.trim(i[1]);h[a]=l=="true"||l=="false"?l=="true"?true:false:isNaN(l)?l:parseFloat(l)}else g.push(e)});c=g.join(";")}}i=j.attr("rel")||"";if(i!==""&&!/^[#|\.]|[\/]/.test(i)){i=i.split(",");c+=";width:"+i[0]+"px;";if(typeof i[1]!="undefined")c+="background:"+i[1]}return[h,c]};b.jatt.preloadImages=function(){for(var j=arguments.length;j--;){var i=document.createElement("img");i.src=arguments[j];s.push(i)}};(function(){var j=d.live?"live":"bind",i=[];b(d.tooltip)[j](d.activate,function(g){var c=b(this), f=d.metadata.toString()=="false"?[d,""]:b.jatt.getMeta(c);h=f[0];var e=c.attr(h.content)===""?c.data("tooltip")||"":c.attr(h.content)||"",a=c.attr("rel")||"",l=c.attr("href")||"";c.data("tooltip",e);c.attr("title","");f='<div id="'+d.tooltipId+'" style="position:absolute;z-index:'+h.zIndex+";"+f[1]+'"></div>';h.local?c.before(f):b("body").append(f);if(e==="")if(a!=="")e=b(a).html()||"No tooltip found";else if(l!==""){e="Loading...";var p=b("<div />");p.load(l,function(){b("#"+d.tooltipId).html(p.html())})}b("#"+ d.tooltipId).html(e).data("options",h);b.jatt.ttrelocate(g,d.tooltipId);b("#"+d.tooltipId).fadeIn(h.speed)})[j](d.deactivate,function(){b("#"+d.tooltipId).remove()})[j]("mousemove",function(g){b("#"+d.tooltipId).length&&h.followMouse&&b.jatt.ttrelocate(g,d.tooltipId)});b(d.preview+","+d.screenshot)[j](d.activate,function(g){var c=b(this),f=d.metadata.toString()=="false"?[d,""]:b.jatt.getMeta(c);h=f[0];var e=c.attr(h.content)===""?c.data("tooltip")||"":c.attr(h.content)||"";c.data("tooltip",e);h.content== "title"&&c.attr(h.content,"");f='<div id="'+d.previewId+'" style="position:absolute;z-index:'+h.zIndex+";"+f[1]+'"><img src="';e=e!==""?"<br/>"+e:"";var a=c.is(d.screenshot)&&c.attr("rel")=="#"?"http://images.websnapr.com/?url="+c.attr("href"):c.attr("rel");f+=c.is(d.preview)?c.attr("href")+'" alt="Image preview" />':a+'" alt="URL preview: '+c.attr("href")+'" />';f+=e+"</div>";h.local?c.before(f):b("body").append(f);b("#"+d.previewId).data("options",h);b.jatt.ttrelocate(g,d.previewId);b("#"+d.previewId).fadeIn(h.speed)})[j](d.deactivate, function(){b("#"+d.previewId).remove()})[j]("mousemove",function(g){b("#"+d.previewId).length&&h.followMouse&&b.jatt.ttrelocate(g,d.previewId)}).each(function(){var g=b(this);g=g.is(d.screenshot)&&g.attr("rel")=="#"?"http://images.websnapr.com/?url="+g.attr("href"):g.attr("rel");i.push(g)});b.jatt.preloadImages(i)})()};b.jatt.defaultOptions={direction:"n",followMouse:true,content:"title",speed:300,local:false,xOffset:20,yOffset:20,zIndex:1E3,live:false,metadata:"class",activate:"mouseenter focusin", deactivate:"mouseleave focusout",tooltip:".tooltip",screenshot:"a.screenshot",preview:"a.preview",tooltipId:"tooltip",previewId:"preview"}})(jQuery);
