/*
 * Jatt - just another tooltip v2.6 min (10/10/2010)
 * http://github.com/Mottie/Jatt
 * by Rob Garrison (aka Mottie)
 *
 * based on tooltip by Alen Grakalic (http://cssglobe.com/post/1695/easiest-tooltip-and-image-preview-using-jquery)
 * tooltip modification by Rob G, aka Mottie (http://wowmotty.blogspot.com/)
 *
 */

(function(b){b.jatt=function(s){var g,t=[],r=b("body"),c=b.extend({},b.jatt.defaultOptions,s);b.jatt.ttrelocate=function(k,h){var m=b(window),f=b("#"+h),d=f.outerWidth(),e=f.outerHeight(),a=f.data("options")||c,i={e:[a.xOffset,-e/2,d+a.xOffset,e/2],se:[a.xOffset,a.yOffset,d+a.xOffset,e+a.yOffset],s:[-d/2,a.yOffset,d/2,e+a.yOffset],sw:[-d-a.xOffset,a.yOffset,-a.xOffset,e+a.yOffset],w:[-d-a.xOffset,-e/2,-a.xOffset,e/2],nw:[-d-a.xOffset,-e-a.yOffset,-a.xOffset,-a.yOffset],n:[-d/2,-e-a.yOffset,d/2,-a.yOffset], ne:[a.xOffset,-e-a.yOffset,d+a.xOffset,-a.yOffset]}[a.direction],p=m.scrollTop(),q=m.scrollLeft(),j=b(k.target),n=k.pageX||j.position().left+j.width()/2,l=k.pageY||j.position().top+j.height()/2;if(!a.followMouse){n=j.outerWidth();l=j.outerHeight();l={e:[n,l/2],se:[n,l],s:[n/2,l],sw:[0,l],w:[0,l/2],nw:[0,0],n:[n/2,0],ne:[n,0]};n=j.offset().left+l[a.direction][0];l=j.offset().top+l[a.direction][1]}j=n+i[0];var o=l+i[1];if(n+i[2]>q+m.width()-a.xOffset)j=m.width()-d-a.xOffset;if(l+i[3]>p+m.height()-a.yOffset)o= l-e-a.yOffset;if(j<q+a.xOffset)j=q+a.xOffset;if(o<p+a.yOffset)o=l+a.yOffset;if(n>j&&n<j+d&&l>o&&l<o+e)o+=o-e/2-a.yOffset<p+a.yOffset?e/2+a.yOffset:-e/2-a.yOffset;f.css({left:j+"px",top:o+"px"})};b.jatt.getMeta=function(k){g=b.extend({},c);var h,m=[],f=k.attr(c.metadata).match(/(\{.*\})/g)||"";if(f!==""){f=f[0].replace(/(\{|\'|\"|\})/g,"");if(f.match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){b.each(f.split(";"),function(d,e){h=e.split(":");if(h[0].match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){var a= b.trim(h[0]),i=b.trim(h[1]);g[a]=i=="true"||i=="false"?i=="true"?true:false:isNaN(i)?i:parseFloat(i)}else m.push(e)});f=m.join(";")}}h=k.attr("rel")||"";if(h!==""&&!/^[#|\.]|[\/]/.test(h)){h=h.split(",");f+=";width:"+h[0]+"px;";if(typeof h[1]!="undefined")f+="background:"+h[1]}return[g,f]};b.jatt.removeTooltips=function(){for(b("#"+c.previewId+", #"+c.tooltipId).remove();b("#"+c.previewId+", #"+c.tooltipId).length>0;)b("#"+c.previewId+", #"+c.tooltipId).remove()};b.jatt.preloadContent=function(){for(var k= arguments.length;k--;){var h=document.createElement("img");h.src=arguments[k];t.push(h)}var m=b(c.tooltip),f=[];m.each(function(d){var e=this.tagName=="A"?b(this).attr("href"):"";if(e!==""&&!e.match(/^#/)){var a=b('<div rel="'+d+'" />');f.push(a);a.load(e,function(){m.eq(a.attr("rel")).data("tooltip",a.html())})}})};(function(){var k=c.live?"live":"bind",h=[];b(c.tooltip)[k](c.activate,function(f){var d=b(this),e=c.metadata.toString()=="false"?[c,""]:b.jatt.getMeta(d);g=e[0];var a=d.attr(g.content)=== ""?d.data("tooltip")||"":d.attr(g.content)||"",i=d.attr("rel")||"",p=d.attr("href")||"";d.data("tooltip",a);d.attr("title","");e='<div id="'+c.tooltipId+'" style="position:absolute;z-index:'+g.zIndex+";"+e[1]+'"></div>';g.local?d.before(e):r.append(e);if(a==="")if(i!=="")a=b(i).html()||c.notFound;else if(p!==""){a=c.loading;var q=b("<div />");q.load(p,function(){var j=q.html(),n=c.cacheData?j:"";b("#"+c.tooltipId).hide().html(j);d.data("tooltip",n);b.jatt.ttrelocate(f,c.tooltipId);b("#"+c.tooltipId).show()})}b("#"+ c.tooltipId).html(a).data("options",g);b.jatt.ttrelocate(f,c.tooltipId);b("#"+c.tooltipId).fadeIn(g.speed)})[k](c.deactivate,function(){b.jatt.removeTooltips()})[k]("mousemove",function(f){b("#"+c.tooltipId).length&&g.followMouse&&b.jatt.ttrelocate(f,c.tooltipId)});var m=function(f,d,e){var a=c.metadata.toString()=="false"?[c,""]:b.jatt.getMeta(d);g=a[0];var i=d.attr(g.content)===""?d.data("tooltip")||"":d.attr(g.content)||"";d.data("tooltip",i);g.content=="title"&&d.attr(g.content,"");e='<div id="'+ c.previewId+'" style="position:absolute;z-index:'+g.zIndex+";"+a[1]+'"><img src="'+e;e+=i!==""?"<br/>"+i+"</div>":"</div>";g.local?d.before(e):r.append(e);b("#"+c.previewId).hide().data("options",g).fadeIn(g.speed);b.jatt.ttrelocate(f,c.previewId)};b(c.preview)[k](c.activate,function(f){m(f,b(this),b(this).attr("href")+'" alt="'+c.imagePreview+'" />')}).each(function(){h.push(b(this).attr("href"))});b(c.screenshot)[k](c.activate,function(f){var d=b(this),e=d.attr("rel")=="#"?"http://images.websnapr.com/?url="+ d.attr("href"):d.attr("rel");e+='" alt="'+c.siteScreenshot+d.attr("href")+'" />';m(f,d,e)}).each(function(){var f=b(this);h.push(f.attr("rel")=="#"?"http://images.websnapr.com/?url="+f.attr("href"):f.attr("rel"))});b(c.preview+","+c.screenshot)[k](c.deactivate,function(){b.jatt.removeTooltips()})[k]("mousemove",function(f){b("#"+c.previewId).length&&g.followMouse&&b.jatt.ttrelocate(f,c.previewId)});b.jatt.preloadContent(h)})()};b.jatt.defaultOptions={direction:"n",followMouse:true,content:"title", speed:300,local:false,xOffset:20,yOffset:20,zIndex:1E3,live:false,metadata:"class",activate:"mouseenter focusin",deactivate:"mouseleave focusout",cacheData:true,loading:"Loading...",notFound:"No tooltip found",imagePreview:"Image preview",siteScreenshot:"URL preview: ",tooltip:".tooltip",screenshot:"a.screenshot",preview:"a.preview",tooltipId:"tooltip",previewId:"preview"}})(jQuery);
