/*
 * Jatt - just another tooltip
 * by Rob Garrison (aka Mottie)
 *
 * based on tooltip by Alen Grakalic (http://cssglobe.com/post/1695/easiest-tooltip-and-image-preview-using-jquery)
 * tooltip modification by Rob G, aka Mottie (http://wowmotty.blogspot.com/)
 *
 * v2.1  8/22/2010 Converted to a plugin, added enhancements & commented out dhtmltooltip script
 * v2.01 8/29/2009 Added Websnapr.com site screenshot option
 * v2.0  6/10/2009 Combined scripts, added support for dhtmltooltip
 * v1.0  5/8/2008  Original tooltip script by Alen Grakalic
 */

function objClone(b){if(null===b||"object"!=typeof b)return b;var n=b.constructor();for(var a in b)if(b.hasOwnProperty(a))n[a]=b[a];return n}
(function(b){b.jatt=function(n){var a,d=b.extend({},b.jatt.defaultOptions,n);b.jatt.ttrelocate=function(f,h){var c=b(h).outerWidth(),e=b(h).outerHeight(),g={e:[a.xOffset,-e/2,c+a.xOffset,e/2],se:[a.xOffset,a.yOffset,c+a.xOffset,e+a.yOffset],s:[-c/2,a.yOffset,c/2,e+a.yOffset],sw:[-c-a.xOffset,a.yOffset,-a.xOffset,e+a.yOffset],w:[-c-a.xOffset,-e/2,-a.xOffset,e/2],nw:[-c-a.xOffset,-e-a.yOffset,-a.xOffset,-a.yOffset],n:[-c/2,-e-a.yOffset,c/2,-a.yOffset],ne:[a.xOffset,-e-a.yOffset,c+a.xOffset,-a.yOffset]}[a.direction],
m=b(window).scrollTop(),j=b(window).scrollLeft(),i=f.pageX,l=f.pageY;if(!a.followMouse){l=b(f.target);i=l.outerWidth();var k=l.outerHeight();k={e:[i,k/2],se:[i,k],s:[i/2,k],sw:[0,k],w:[0,k/2],nw:[0,0],n:[i/2,0],ne:[i,0]};i=l.offset().left+k[a.direction][0];l=l.offset().top+k[a.direction][1]}k=i+g[0];var o=l+g[1];if(i+g[2]>j+b(window).width()-a.xOffset)k=b(window).width()-c-a.xOffset;if(l+g[3]>m+b(window).height()-a.yOffset)o=l-e-a.yOffset;if(k<j+a.xOffset)k=j+a.xOffset;if(o<m+a.yOffset)o=l+a.yOffset;
b(h).css({left:k+"px",top:o+"px"})};b.jatt.getMeta=function(f){a=objClone(d);var h,c="";f=f.attr(d.metadata).match(/(\{.*\})/g)||"";if(f!==""){f=f[0].replace(/(\{|\'|\"|\})/g,"");if(f.match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){b.each(f.split(";"),function(e,g){h=g.split(":");if(h[0].match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){var m=b.trim(h[0]),j=b.trim(h[1]);a[m]=j=="true"||j=="false"?j=="true"?true:false:isNaN(j)?j:parseFloat(j)}else c+=
g+";"});f=c}}return[a,f]};(function(){var f=d.live?"live":"bind";b("."+d.tooltip)[f](d.activate,function(h){var c=b(this),e=d.metadata.toString()=="false"?[d,""]:b.jatt.getMeta(c);a=e[0];var g=c.attr(a.content)===""?c.data("tooltip")||"":c.attr(a.content)||"",m=c.attr("rel")||"",j=c.attr("href")||"";c.data("tooltip",g);c.attr("title","");if(g==="")if(m!=="")g=b(m).html()||"No tooltip found";else if(j!==""){g="Loading...";b("body").append('<div id="ttloader"></div>');var i=b("#ttloader");i.load(j,
function(){b("#"+d.tooltip).html(i.html());c.data("tooltip",i.html());i.remove()})}e='<div id="'+d.tooltip+'" style="position:absolute;z-index:'+a.zIndex+";"+e[1]+'">'+g+"</div>";a.local?c.before(e):b("body").append(e);b.jatt.ttrelocate(h,"#"+d.tooltip);b("#"+d.tooltip).fadeIn(a.speed)})[f](d.deactivate,function(){b("#"+d.tooltip).remove()})[f]("mousemove",function(h){a.followMouse&&b.jatt.ttrelocate(h,"#"+d.tooltip)});b("a."+d.preview+", a."+d.screenshot)[f](d.activate,function(h){var c=b(this),
e=d.metadata.toString()=="false"?[d,""]:b.jatt.getMeta(c);a=e[0];var g=c.attr(a.content)===""?c.data("tooltip")||"":c.attr(a.content)||"";c.data("tooltip",g);a.content=="title"&&c.attr(a.content,"");e='<div id="'+d.preview+'" style="position:absolute;z-index:'+a.zIndex+";"+e[1]+'"><img src="';g=g!==""?"<br/>"+g:"";var m=c.is("."+d.screenshot)&&this.rel=="#"?"http://images.websnapr.com/?url="+this.href:this.rel;e+=c.is("."+d.preview)?this.href+'" alt="Image preview" />':m+'" alt="URL preview: '+this.href+
'" />';e+=g+"</div>";a.local?c.before(e):b("body").append(e);b("#"+d.preview).data("options",a);b.jatt.ttrelocate(h,"#"+d.preview);b("#"+d.preview).fadeIn(a.speed)})[f](d.deactivate,function(){b("#"+d.preview).remove()})[f]("mousemove",function(h){a.followMouse&&b.jatt.ttrelocate(h,"#"+d.preview)})})()};b.jatt.defaultOptions={direction:"n",followMouse:true,content:"title",speed:300,local:false,xOffset:20,yOffset:20,zIndex:1E3,live:false,metadata:"class",activate:"mouseenter focusin",deactivate:"mouseleave focusout",
tooltip:"tooltip",screenshot:"screenshot",preview:"preview"}})(jQuery);
