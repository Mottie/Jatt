/*
 * Jatt - just another tooltip
 * by Rob Garrison (aka Mottie)
 *
 * based on tooltip by Alen Grakalic (http://cssglobe.com/post/1695/easiest-tooltip-and-image-preview-using-jquery)
 * tooltip modification by Rob G, aka Mottie (http://wowmotty.blogspot.com/)
 *
 * v2.1  8/22/2010 Converted to a plugin, added enhancements & commented out dhtmltooltip script
 * v2.01 8/29/2009 Added Websnapr.com site screenshot option
 * v2.0  6/10/2009 Combined scripts, added support for dhtmltooltip
 * v1.0  5/8/2008  Original tooltip script by Alen Grakalic
 */

function objClone(m){if(null===m||"object"!=typeof m)return m;var a=m.constructor();for(var b in m)if(m.hasOwnProperty(b))a[b]=m[b];return a}
(function($){$.jatt=function(m){var a,b=$.extend({},$.jatt.defaultOptions,m);$.jatt.ttrelocate=function(e,i){var d=$(i).outerWidth(),c=$(i).outerHeight(),g={e:[a.xOffset,-c/2,d+a.xOffset,c/2],se:[a.xOffset,a.yOffset,d+a.xOffset,c+a.yOffset],s:[-d/2,a.yOffset,d/2,c+a.yOffset],sw:[-d-a.xOffset,a.yOffset,-a.xOffset,c+a.yOffset],w:[-d-a.xOffset,-c/2,-a.xOffset,c/2],nw:[-d-a.xOffset,-c-a.yOffset,-a.xOffset,-a.yOffset],n:[-d/2,-c-a.yOffset,d/2,-a.yOffset],ne:[a.xOffset,-c-a.yOffset,d+a.xOffset,-a.yOffset]}[a.direction],
l=$(window).scrollTop(),k=$(window).scrollLeft(),f=e.pageX,j=e.pageY;if(!a.followMouse){j=$(e.target);f=j.outerWidth();var h=j.outerHeight();h={e:[f,h/2],se:[f,h],s:[f/2,h],sw:[0,h],w:[0,h/2],nw:[0,0],n:[f/2,0],ne:[f,0]};f=j.offset().left+h[a.direction][0];j=j.offset().top+h[a.direction][1]}h=f+g[0];var n=j+g[1];if(f+g[2]>k+$(window).width()-a.xOffset)h=$(window).width()-d-a.xOffset;if(j+g[3]>l+$(window).height()-a.yOffset)n=j-c-a.yOffset;if(h<k+a.xOffset)h=k+a.xOffset;if(n<l+a.yOffset)n=j+a.yOffset;
$(i).css({left:h+"px",top:n+"px"})};$.jatt.getMeta=function(e){a=objClone(b);var i,d="";e=e.attr(b.metadata).match(/(\{.*\})/g)||"";if(e!==""){e=e[0].replace(/(\{|\'|\"|\})/g,"");if(e.match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){$.each(e.split(";"),function(c,g){i=g.split(":");if(i[0].match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){var l=$.trim(i[0]),k=$.trim(i[1]);a[l]=k=="true"||k=="false"?k=="true"?true:false:isNaN(k)?k:parseFloat(k)}else d+=
g+";"});e=d}}return[a,e]};(function(){var e=b.live?"live":"bind";$("."+b.tooltip)[e](b.activate,function(i){var d,c=$(this),g=b.metadata.toString()=="false"?[b,""]:$.jatt.getMeta(c);a=g[0];var l=c.attr(a.content)===""?c.data("tooltip")||"":c.attr(a.content)||"",k=c.attr("rel")||"",f=c.attr("href")||"";c.data("tooltip",l);a.content=="title"&&c.attr(a.content,"");if(l==="")if(k!=="")l=$(k).html()||"No tooltip found";else if(f!==""){l="Loading...";$.get(f,function(j){f=f.split(" ");f.shift();var h=f.shift()||
"";f=f.join(" ");d=h.match(/\#|\./)?f===""?$(j).filter(h).html():$(j).filter(h).find(f).html():j;$("#"+b.tooltip).html(d);c.data("tooltip",d)})}g='<div id="'+b.tooltip+'" style="position:absolute;z-index:'+a.zIndex+";"+g[1]+'">'+l+"</div>";a.local?c.before(g):$("body").append(g);$.jatt.ttrelocate(i,"#"+b.tooltip);$("#"+b.tooltip).fadeIn(a.speed)})[e](b.deactivate,function(){$("#"+b.tooltip).remove()})[e]("mousemove",function(i){a.followMouse&&$.jatt.ttrelocate(i,"#"+b.tooltip)});$("a."+b.preview+
", a."+b.screenshot)[e](b.activate,function(i){var d=$(this),c=b.metadata.toString()=="false"?[b,""]:$.jatt.getMeta(d);a=c[0];var g=d.attr(a.content)===""?d.data("tooltip")||"":d.attr(a.content)||"";d.data("tooltip",g);a.content=="title"&&d.attr(a.content,"");c='<div id="'+b.preview+'" style="position:absolute;z-index:'+a.zIndex+";"+c[1]+'"><img src="';g=g!==""?"<br/>"+g:"";var l=d.is("."+b.screenshot)&&this.rel=="#"?"http://images.websnapr.com/?url="+this.href:this.rel;c+=d.is("."+b.preview)?this.href+
'" alt="Image preview" />':l+'" alt="URL preview: '+this.href+'" />';c+=g+"</div>";a.local?d.before(c):$("body").append(c);$("#"+b.preview).data("options",a);$.jatt.ttrelocate(i,"#"+b.preview);$("#"+b.preview).fadeIn(a.speed)})[e](b.deactivate,function(){$("#"+b.preview).remove()})[e]("mousemove",function(i){a.followMouse&&$.jatt.ttrelocate(i,"#"+b.preview)})})()};$.jatt.defaultOptions={direction:"n",followMouse:true,content:"title",speed:300,local:false,xOffset:20,yOffset:20,zIndex:1E3,live:false,
metadata:"class",activate:"mouseenter focusin",deactivate:"mouseleave focusout",tooltip:"tooltip",screenshot:"screenshot",preview:"preview"}})(jQuery);
