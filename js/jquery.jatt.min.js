/*
 * Jatt - just another tooltip v2.3 min (10/10/2010)
 * http://github.com/Mottie/Jatt
 * by Rob Garrison (aka Mottie)
 *
 * based on tooltip by Alen Grakalic (http://cssglobe.com/post/1695/easiest-tooltip-and-image-preview-using-jquery)
 * tooltip modification by Rob G, aka Mottie (http://wowmotty.blogspot.com/)
 *
 */

(function($){$.jatt=function(q){var h,c=$.extend({},$.jatt.defaultOptions,q);$.jatt.ttrelocate=function(k,g){var b=$(window),d=$("#"+g),e=d.outerWidth(),f=d.outerHeight(),a=d.data("options"),j={e:[a.xOffset,-f/2,e+a.xOffset,f/2],se:[a.xOffset,a.yOffset,e+a.xOffset,f+a.yOffset],s:[-e/2,a.yOffset,e/2,f+a.yOffset],sw:[-e-a.xOffset,a.yOffset,-a.xOffset,f+a.yOffset],w:[-e-a.xOffset,-f/2,-a.xOffset,f/2],nw:[-e-a.xOffset,-f-a.yOffset,-a.xOffset,-a.yOffset],n:[-e/2,-f-a.yOffset,e/2,-a.yOffset],ne:[a.xOffset, -f-a.yOffset,e+a.xOffset,-a.yOffset]}[a.direction],o=b.scrollTop(),p=b.scrollLeft(),m=k.pageX,l=k.pageY;if(!a.followMouse){l=$(k.target);m=l.outerWidth();var i=l.outerHeight();i={e:[m,i/2],se:[m,i],s:[m/2,i],sw:[0,i],w:[0,i/2],nw:[0,0],n:[m/2,0],ne:[m,0]};m=l.offset().left+i[a.direction][0];l=l.offset().top+i[a.direction][1]}i=m+j[0];var n=l+j[1];if(m+j[2]>p+b.width()-a.xOffset)i=b.width()-e-a.xOffset;if(l+j[3]>o+b.height()-a.yOffset)n=l-f-a.yOffset;if(i<p+a.xOffset)i=p+a.xOffset;if(n<o+a.yOffset)n= l+a.yOffset;if(m>i&&m<i+e&&l>n&&l<n+f)n+=n-f/2-a.yOffset<o+a.yOffset?f/2+a.yOffset:-f/2-a.yOffset;d.css({left:i+"px",top:n+"px"})};$.jatt.getMeta=function(k){h=$.extend({},c);var g,b=[],d=k.attr(c.metadata).match(/(\{.*\})/g)||"";if(d!==""){d=d[0].replace(/(\{|\'|\"|\})/g,"");if(d.match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){$.each(d.split(";"),function(e,f){g=f.split(":");if(g[0].match("direction|followMouse|content|speed|local|xOffset|yOffset|zIndex")){var a=$.trim(g[0]), j=$.trim(g[1]);h[a]=j=="true"||j=="false"?j=="true"?true:false:isNaN(j)?j:parseFloat(j)}else b.push(f)});d=b.join(";")}}g=k.attr("rel")||"";if(g!==""&&!/^[#|\.]|[\/]/.test(g)){g=g.split(",");d+=";width:"+g[0]+"px;";if(typeof g[1]!="undefined")d+="background:"+g[1]}return[h,d]};(function(){var k=c.live?"live":"bind";$(c.tooltip)[k](c.activate,function(g){var b=$(this),d=c.metadata.toString()=="false"?[c,""]:$.jatt.getMeta(b);h=d[0];var e=b.attr(h.content)===""?b.data("tooltip")||"":b.attr(h.content)|| "",f=b.attr("rel")||"",a=b.attr("href")||"";b.data("tooltip",e);b.attr("title","");d='<div id="'+c.tooltipId+'" style="position:absolute;z-index:'+h.zIndex+";"+d[1]+'"></div>';h.local?b.before(d):$("body").append(d);if(e==="")if(f!=="")e=$(f).html()||"No tooltip found";else if(a!==""){e="Loading...";var j=$("<div />");j.load(a,function(){$("#"+c.tooltipId).html(j.html())})}$("#"+c.tooltipId).html(e).data("options",h);$.jatt.ttrelocate(g,c.tooltipId);$("#"+c.tooltipId).fadeIn(h.speed)})[k](c.deactivate, function(){$("#"+c.tooltipId).remove()})[k]("mousemove",function(g){$("#"+c.tooltipId).length&&h.followMouse&&$.jatt.ttrelocate(g,c.tooltipId)});$(c.preview+","+c.screenshot)[k](c.activate,function(g){var b=$(this),d=c.metadata.toString()=="false"?[c,""]:$.jatt.getMeta(b);h=d[0];var e=b.attr(h.content)===""?b.data("tooltip")||"":b.attr(h.content)||"";b.data("tooltip",e);h.content=="title"&&b.attr(h.content,"");d='<div id="'+c.previewId+'" style="position:absolute;z-index:'+h.zIndex+";"+d[1]+'"><img src="'; e=e!==""?"<br/>"+e:"";var f=b.is(c.screenshot)&&b.attr("rel")=="#"?"http://images.websnapr.com/?url="+b.attr("href"):b.attr("rel");d+=b.is(c.preview)?b.attr("href")+'" alt="Image preview" />':f+'" alt="URL preview: '+b.attr("href")+'" />';d+=e+"</div>";h.local?b.before(d):$("body").append(d);$("#"+c.previewId).data("options",h);$.jatt.ttrelocate(g,c.previewId);$("#"+c.previewId).fadeIn(h.speed)})[k](c.deactivate,function(){$("#"+c.previewId).remove()})[k]("mousemove",function(g){$("#"+c.previewId).length&& h.followMouse&&$.jatt.ttrelocate(g,c.previewId)})})()};$.jatt.defaultOptions={direction:"n",followMouse:true,content:"title",speed:300,local:false,xOffset:20,yOffset:20,zIndex:1E3,live:false,metadata:"class",activate:"mouseenter focusin",deactivate:"mouseleave focusout",tooltip:".tooltip",screenshot:"a.screenshot",preview:"a.preview",tooltipId:"tooltip",previewId:"preview"}})(jQuery);
